{{- define "main" -}}

{{- if .Resources.GetMatch "cover-image" -}}
<section class="relative block" style="height: 500px;">
  <div class="absolute top-0 w-full h-full bg-center bg-cover"
    style='background-image: url({{ (.Resources.GetMatch "cover-image").Permalink }});'>
    <span id="blackOverlay" class="absolute w-full h-full bg-black opacity-50"></span>
  </div>
  <div class="absolute bottom-0 left-0 right-0 top-auto w-full overflow-hidden pointer-events-none"
    style="height: 70px; transform: translateZ(0px);">
    <svg class="absolute bottom-0 overflow-hidden" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none"
      version="1.1" viewBox="0 0 2560 100" x="0" y="0">
      <polygon class="text-gray-300 fill-current" points="2560 0 2560 100 0 100"></polygon>
    </svg>
  </div>
</section>
{{- end -}}
<section class="relative py-16 bg-gray-300">
  <div class="container px-4 mx-auto">
    <div
      class="relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-xl rounded-lg {{ if .Resources.GetMatch "cover-image" }}-mt-64{{ end }}">
      <div class="px-6">
        <div class="mt-12 text-center">
          <h1 class="mb-2 text-4xl font-semibold leading-normal text-gray-800">
            {{ .Title }}
          </h1>
          <div class="mt-0 mb-2 text-sm font-bold leading-normal text-gray-500">
            <i class="mr-2 text-lg text-gray-500 far fa-calendar-alt"></i>
            <time datetime="{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}"
              title="Date de publication">
              Publié le {{ .PublishDate.Day }} {{ index $.Site.Data.mois (printf "%d" .PublishDate.Month) }}
              {{ .PublishDate.Year }} à {{ .PublishDate.Format "15:04" }}
            </time>
            {{ if ne .PublishDate .Lastmod }}
            <br class="inline md:hidden">
            <i class="ml-2 mr-2 text-lg text-gray-500 far fa-calendar-edit"></i>
            <time datetime="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | safeHTML }}"
              title="Dernière mise à jour du contenu">Dernière mise à jour le
              {{ .Lastmod.Day }} {{ index $.Site.Data.mois (printf "%d" .Lastmod.Month) }} {{ .Lastmod.Year }} à
              {{ .Lastmod.Format "15:04" }}
            </time>
            {{ end }}
          </div>
          {{- if .Params.auteurs -}}
          {{- $len := (len .Params.auteurs) -}}
          <div class="mt-10 mb-2 text-gray-700">
            <i
              class="far {{if gt (len .Params.auteurs) 1}}fa-users{{ else }}fa-user{{ end }} mr-2 text-lg text-gray-500"></i>
            par&nbsp;
            {{- range $index, $element := .Params.auteurs -}}
            {{- with $.Site.GetPage "taxonomyTerm" (printf "auteurs/%s" (urlize $element)) -}}
            {{- if and (gt $index 0) (eq (add $index 1) $len) -}}&nbsp;et&nbsp;{{- else if gt $index 0 -}},&nbsp;{{- end -}}
            <a class="text-base font-semibold leading-6 text-teal-600 transition duration-150 ease-in-out hover:text-teal-500"
              href="{{ .Permalink }}">{{ .Params.name }}</a>
            {{- end -}}
            {{- end -}}
          </div>
          {{- end -}}
          {{- if (and (index .Aliases 0) .Params.publication_id) -}}
          {{- $aliasAbsoluteUrl := (index .Aliases 0) | absURL -}}
          <div class="mb-2 text-gray-700">
            <i class="mr-2 text-lg text-gray-500 far fa-link"></i>
            Référence et lien court: <a href="{{ $aliasAbsoluteUrl }}"
              class="text-base font-semibold leading-6 text-teal-600 transition duration-150 ease-in-out hover:text-teal-500">{{ .Params.publication_id }}</a>
          </div>
          {{- end -}}
        </div>
        <div class="py-10 mt-10 border-t border-gray-300">
          <div class="flex flex-wrap justify-center">
            <div class="w-full px-4 prose lg:w-9/12 max-w-none font-readable">
              {{ .Summary | emojify }}
            </div>
            {{ if and (gt .WordCount 400 ) (.Params.toc) }}
            <aside class="block w-full p-4 lg:p-8 prise lg:w-9/12 max-w-none">
              <div x-data="{ open: true }" @keydown.window.escape="open = false" @click.away="open = false"
                class="relative block w-full text-left">
                <div>
                  <span class="rounded-md shadow-sm">
                    <button @click="open = !open" type="button"
                      class="inline-flex justify-center w-full px-4 py-2 text-sm font-medium leading-5 text-gray-700 transition duration-150 ease-in-out bg-white border border-gray-300 rounded-md hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800"
                      id="options-menu" aria-haspopup="true" x-bind:aria-expanded="open">
                      Sommaire
                      <svg class="w-5 h-5 ml-2 -mr-1" x-description="Heroicon name: chevron-down"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                          clip-rule="evenodd"></path>
                      </svg>
                    </button>
                  </span>
                </div>
                <div class="prose font-readable" x-show="open" x-transition:enter="transition ease-out duration-100"
                  x-transition:enter-start="transform opacity-0 scale-95"
                  x-transition:enter-end="transform opacity-100 scale-100"
                  x-transition:leave="transition ease-in duration-75"
                  x-transition:leave-start="transform opacity-100 scale-100"
                  x-transition:leave-end="transform opacity-0 scale-95"
                  class="absolute right-0 w-full mt-2 origin-top-right rounded-md shadow-lg" style="display: none;">
                  {{ .TableOfContents }}
                </div>
              </div>
            </aside>
            {{ end }}
            <div class="w-full px-4 py-4 prose lg:w-9/12 max-w-none font-readable">
              {{ $body := replace .Content .Summary "" }}
              {{ $body | emojify }}
            </div>
            {{- if .Params.legal_warning -}}
            <div
              class="px-4 py-5 mt-10 prose bg-blue-100 border border-blue-200 rounded sm:px-6 max-w-none font-readable">
              <strong>Attention</strong>: les conseils fournis dans cet article
              ne sauraient se substituer à la consultation d'experts. Nous ne
              pourrons être tenus responsable d'aucun litige lié aux
              informations données dans le présent document.
              Pensez à consulter nos <a href="{{ "/mentions-legales" | relURL }}">mentions légales</a>.
            </div>
            {{- end -}}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{{- end -}}